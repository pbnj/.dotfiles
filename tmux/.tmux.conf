# vim:ft=conf:

# SENSIBLE

set-option -g base-index 1
set-option -g default-terminal 'xterm-256color'
set-option -g focus-events on
set-option -g history-limit 20000 # set history to 20,000 entries
set-option -g mouse off # enable mouse support
set-option -g renumber-windows on # renumber windows when earlier ones are killed/closed
set-option -g wrap-search off # disable wrapping around when searching, similar to vim's 'wrapscan'
set-option -ga terminal-overrides ',xterm-256color:Tc'
set-option -sg escape-time 0 # reduce lag in vim/neovim when ESC is pressed
set-window-option -g mode-keys vi # support vi copy/paste
set-window-option -g pane-base-index 1 # pane numbering starts with 1

# OS-specific configs
if-shell 'uname | grep -q Darwin' 'source-file ~/.config/tmux/.tmux.conf.osx'
if-shell 'uname | grep -q Linux' 'source-file ~/.config/tmux/.tmux.conf.linux'

###############################################################################
# KEYBINDINGS
###############################################################################

# https://gist.github.com/brendanhay/1769870#gistcomment-2334245
bind-key -T copy-mode-vi v send -X begin-selection
bind-key -T edit-mode-vi Down send-keys -X history-down
bind-key -T edit-mode-vi Up send-keys -X history-up
bind-key C-[ copy-mode
bind-key / copy-mode \; send-key / # prefix + / to search down

# Launch projects in new window. See utils/bin/open-project
bind-key C-w run-shell -b 'open-project'

# Open any URL from the terminal. See utils/bin/open-url
bind-key C-u run-shell -b "open-url"

# Open git files in remote repositories in the browser.
# Requires: tmux, git, fzf-tmux (ships with fzf), git-extras
bind-key C-g run-shell -b "git -C #{pane_current_path} ls-files --full | fzf-tmux --reverse --multi --height=20 | xargs -L1 git -C #{pane_current_path} browse $(git -C #{pane_current_path} config branch.""$(git -C #{pane_current_path} rev-parse --abbrev-ref HEAD 2>/dev/null)"".remote || echo 'origin')"

########################################
# WINDOW/PANE CONTROLS
# https://github.com/tmux-plugins/tmux-pain-control/blob/master/pain_control.tmux
########################################

# Windows
## Nav
bind-key '<' swap-window -t -1
bind-key '>' swap-window -t +1
bind-key 'c' new-window -c '#{pane_current_path}'
bind-key C-n select-window -n
bind-key C-p select-window -p

## Spliting
bind-key 'v' split-window -h -c '#{pane_current_path}'   # <prefix>b + v : split horizontal
bind-key "\\" split-window -h -c '#{pane_current_path}'  # <prefix>b + \ : split horizontal
bind-key 'V' split-window -fh -c '#{pane_current_path}'  # <prefix>b + V : split full horizontal
bind-key '|' split-window -fh -c '#{pane_current_path}'  # <prefix>b + | : split full horizontal
bind-key 's' split-window -v -c '#{pane_current_path}'   # <prefix>b + s : split vertical
bind-key '-' split-window -v -c '#{pane_current_path}'   # <prefix>b + - : split vertical
bind-key 'S' split-window -fv -c '#{pane_current_path}'  # <prefix>b + S : split full vertical
bind-key '_' split-window -fv -c '#{pane_current_path}'  # <prefix>b + _ : split full vertical
bind-key '%' split-window -h -c '#{pane_current_path}'   # <prefix>b + % : default split horizontal
bind-key "'" split-window -v -c '#{pane_current_path}'   # <prefix>b + " : default split vertical

# Panes
## Nav
# bind-key h select-pane -L
# bind-key j select-pane -D
# bind-key k select-pane -U
# bind-key l select-pane -R

## Resize
bind-key -r H resize-pane -L '5'
bind-key -r J resize-pane -D '5'
bind-key -r K resize-pane -U '5'
bind-key -r L resize-pane -R '5'

###############################################################################
# STATUS BAR
###############################################################################

set-option -g status-position         top
set-option -g status-interval         1
set-option -g automatic-rename        on
set-option -g automatic-rename-format '#{b:pane_current_path}'

########################################
# status-right
########################################

set-option -g status-right-length 200

# Basic status bar
set-option -g status-right '#{?client_prefix,#[reverse][prefix]#[noreverse],} [%A %Y-%m-%d %l:%M %p]'

# Status bar with resource monitoring, requires `tmux-mem-cpu-load`, see https://github.com/thewtex/tmux-mem-cpu-load
set-option -g status-right "#{?client_prefix,#[reverse][prefix]#[noreverse],} #(tmux-mem-cpu-load --interval 1) [%A, %d %b %Y %l:%M %p]"
