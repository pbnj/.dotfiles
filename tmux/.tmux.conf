# SENSIBLE

set-option -g base-index 1
set-option -g default-terminal 'xterm-256color'
set-option -g focus-events on
set-option -g history-limit 20000 # set history to 20,000 entries
set-option -g mouse on
set-option -g renumber-windows on # renumber windows when earlier ones are killed/closed
set-option -g wrap-search off # disable wrapping around when searching, similar to vim's 'wrapscan'
set-option -sg escape-time 0 # reduce lag in vim/neovim when ESC is pressed
set-window-option -g mode-keys vi # support vi copy/paste
set-window-option -g pane-base-index 1 # pane numbering starts with 1

if-shell '[[ $(uname -s) == Darwin ]]' { set -s copy-command 'pbcopy' }

###############################################################################
# KEYBINDINGS
###############################################################################

# pane rotation is annoying
unbind C-o

# https://gist.github.com/brendanhay/1769870#gistcomment-2334245
bind-key -T copy-mode-vi v send -X begin-selection
bind-key -T edit-mode-vi Down send-keys -X history-down
bind-key -T edit-mode-vi Up send-keys -X history-up
bind-key C-[ copy-mode
bind-key / copy-mode \; send-key / # prefix + / to search down

# Open any URL from the terminal. See utils/bin/open-url
bind-key C-u run-shell -b 'open-url'
bind-key C-c run-shell -b 'open-project'

# Open git files in remote repositories in the browser.
# Requires: tmux, git, fzf-tmux (ships with fzf), git-extras
bind-key C-g run-shell -b "git -C #{pane_current_path} ls-files --full | fzf-tmux --reverse --multi | xargs -L1 git -C #{pane_current_path} browse $(git -C #{pane_current_path} config branch.""$(git -C #{pane_current_path} rev-parse --abbrev-ref HEAD 2>/dev/null)"".remote || echo 'origin')"

########################################
# WINDOW/PANE CONTROLS
# https://github.com/tmux-plugins/tmux-pain-control/blob/master/pain_control.tmux
########################################

# Windows
## Nav
bind-key '<' swap-window -t -1
bind-key '>' swap-window -t +1
bind-key 'c' new-window -c '#{pane_current_path}'
bind-key C-n select-window -n
bind-key C-p select-window -p

## Spliting
bind-key 'v' split-window -h -c '#{pane_current_path}'   # <prefix>b + v : split horizontal
bind-key "\\" split-window -h -c '#{pane_current_path}'  # <prefix>b + \ : split horizontal
bind-key 'V' split-window -fh -c '#{pane_current_path}'  # <prefix>b + V : split full horizontal
bind-key '|' split-window -fh -c '#{pane_current_path}'  # <prefix>b + | : split full horizontal
bind-key 's' split-window -v -c '#{pane_current_path}'   # <prefix>b + s : split vertical
bind-key '-' split-window -v -c '#{pane_current_path}'   # <prefix>b + - : split vertical
bind-key 'S' split-window -fv -c '#{pane_current_path}'  # <prefix>b + S : split full vertical
bind-key '_' split-window -fv -c '#{pane_current_path}'  # <prefix>b + _ : split full vertical
bind-key '%' split-window -h -c '#{pane_current_path}'   # <prefix>b + % : default split horizontal
bind-key "'" split-window -v -c '#{pane_current_path}'   # <prefix>b + " : default split vertical

# Panes
## Nav
bind-key C-h select-pane -L
bind-key C-j select-pane -D
bind-key C-k select-pane -U
bind-key C-l select-pane -R

###############################################################################
# STATUS BAR
###############################################################################

set-option -g status-position bottom
set-option -g automatic-rename on
set-option -g automatic-rename-format '#{b:pane_current_path} #(git -C #{pane_current_path} prompt)'
set-window -g window-status-current-format "#[reverse] #I:#W"

# # pane-specific status bar
# set -g pane-border-status off
# set -g pane-border-format " #{b:pane_current_path} #(git -C #{pane_current_path} prompt) [#{pane_current_command}] "

########################################
# status-right
########################################

# Basic status bar
set-option -g status-right '#{?client_prefix,#[reverse][prefix]#[noreverse],} [%A %Y-%m-%d %l:%M %p]'
