#!/bin/bash

# fuzzy project finder

set -euo pipefail

INITIAL_QUERY="${1:-}"

(
  gfind "${HOME}" -type d -name .git -execdir test -d '.git' \; -print -prune ||
    find "${HOME}" -type d -name .git -execdir test -d '.git' \; -print -prune
) | xargs -I{} dirname {} |
  fzf-tmux \
    -p '80%' \
    --reverse \
    --bind 'enter:become(tmux new-window -c {})' \
    --prompt "Projects > " \
    --query "${INITIAL_QUERY}" || true
