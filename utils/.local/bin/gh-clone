#!/bin/bash

set -euo pipefail

GH_ORG="${1:-$(gh org list | fzf-tmux -p '80%' --prompt 'GitHub Organizations > ')}"
GH_SEARCH_PREFIX="gh search repos --json url --jq .[].url --owner=${GH_ORG}"

fzf-tmux \
  -p '80%' \
  --reverse \
  --header '<CTRL-R>: refresh search' \
  --bind "start:reload:${GH_SEARCH_PREFIX} {q}" \
  --bind "ctrl-r:reload:${GH_SEARCH_PREFIX} {q}" \
  --bind "change:reload:sleep 0.1; ${GH_SEARCH_PREFIX} {q} || true" \
  --prompt "GitHub Repo Search > " |
  xargs -t -I{} git clone-tmux {} || true
