#!/bin/bash

# Open any URL in the tmux buffer without using the mouse to select text, copy, paste.
# How it works:
# 1. Dump content of tmux buffer to stdout
# 2. Grep for URL patterns using `gw` customer wrapper (see https://github.com/pbnj/dotfiles/tree/main/gw)
# 3. Search & select one or more URLs via `fzf` fuzzy finder
# 4. Open selected URL(s). If native file openers do not exist, fallback to `open-cli`

set -eou pipefail

OPEN_PROG="npx open-cli"

if hash open >/dev/null 2>&1; then
	OPEN_PROG="$(which open)"
elif hash xdg-open >/dev/null 2>&1; then
	OPEN_PROG="$(which xdg-open)"
fi

URLS="$(
	tmux capture-pane -J -p |
		gw url |
		fzf-tmux --reverse --height=20 --multi ||
		true
)"

if test -n "${URLS}"; then
	for u in ${URLS}; do
		"${OPEN_PROG}" "${u}"
	done
else
	exit 0
fi
