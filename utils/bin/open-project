#!/bin/bash

# Project Manager
# Open any project in a new tmux window.
# How it works:
# 1. Run `fd` or `find` to enumerate/list all projects under `${HOME}/Projects/`
# 2. Filter results through `fzf` fuzzy finder to select one or more project
# 3. Open select project(s) in tmux new window

set -eou pipefail

FIND_PROG="$(which fd)"
FIND_TYPE="${1:-"d"}"
FIND_ARGS=". --type=${FIND_TYPE}"
FIND_DIR="${HOME}/Projects"

if [[ -z "${FIND_PROG}" ]]; then
	FIND_PROG="$(which find)"
	FIND_ARGS="-type ${FIND_TYPE} \( -path *.git -or -path *.terraform -or -path *node_modules \) -prune -print"
fi

SELECTED="$(
	${FIND_PROG} ${FIND_ARGS} ${FIND_DIR} |
		fzf-tmux \
			--reverse \
			--multi \
			--prompt "${FIND_PROG} ${FIND_ARGS} ${FIND_DIR}> " ||
		true
)"

if test -n "${SELECTED}"; then
	for s in ${SELECTED}; do
		tmux new-window "vim ${s}"
	done
else
	exit 0
fi
